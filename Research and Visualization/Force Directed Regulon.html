<!DOCTYPE html>
<meta charset="utf-8">
<title>Force Directed Regulon</title>
<style>

.node {
  stroke: #fff;
  stroke-width: 1.5px;
}

.link {
  stroke: #999;
  stroke-opacity: .6;
}

</style>
<body>
<div>
  <h3>Force-Directed Regulon of Mycobacterium tuberculosis</h3>
  <p>
    This graphic represents the many directed connections between transcription factors and the genes they control in Mycobacterium tuberculosis, the bacteria that causes the disease Tuberculosis. Visualized here is just the network of metabolic controls for transitioning from an aerobic to an anaerobic environment, which is believed to be important to understanding how the bacteria can survive for extended periods of time dormant in a human host.
  </p>
  <p>
    <span style="color: blue">Blue</span> edges represent inhibition of expression. <span style="color: red">Red</span> edges represent enhancement of expression
  </p>
  <p>
    Transcription factors are shown in <span style="color: green">green</span> and metabolic genes in <span style="color: blue">blue</span>. The regulator of interest, Rv0757 or PhoP, is <span style="color: teal">teal</span>. All data shown here was generated by the Galagan Lab at Boston University. All gene symbols come from the <a href="http://www.tbdb.org/">TBDB</a>. 
  </p>
</div>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>
var data = {};
var time = 0;

var width = 2000,
    height = 2000;

var force = d3.layout.force()
    .charge(function(d){
      var val = d.regulonSize > 0 ? -4000 : 0;
      return val 
    })
    .gravity(function(d){
      return 0.01;
    })
    .linkDistance(function(d){ 
      var val = d.regulonSize > 0 ? 500 : 30
      return val; 
    })
    .linkStrength(1)
    .size([width, height]).alpha(0.5);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

d3.json("regulon.json", function(error, graph) {
  force
      .nodes(graph.nodes)
      .links(graph.links)
      .start();

  data = graph;

  var link = svg.selectAll(".link")
      .data(graph.links)
    .enter().append("line")
      .attr("class", "link")
      .style("stroke", function(d) { 
          return d.foldChange > 0 ? 'red' : 'blue'; })
      .style("stroke-width", function(d){return Math.sqrt(Math.abs( d.foldChange ))});

  var node = svg.selectAll(".node")
      .data(graph.nodes)
    .enter().append("circle")
      .attr("class", "node")
      .style("fill", function(d) { 
        var val = d.regulonSize > 1 ? 'green' : 'blue';
        if (d.name == 'Rv0757'){ val = 'teal' }
        return val; 
      })
      .attr("r", function(d) { return Math.sqrt(d.regulonSize) < 3 ? 3 : Math.sqrt(d.regulonSize) })
      .attr('fixed', function(d){
        
      })
      .attr("diagnostic", function(d,i,m){
      })
      .call(force.drag);

  node.append("title")
      .text(function(d) { return d.name + ' ' + d.weight; });

  force.on("tick", function(e) {
    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    node.attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });

    if (time == 1) {
      //debug here
    }
    if(time == 0){
      node.attr("nope", function(d){
        d.fixed = d.regulonSize > 0 ? true : false;
      })
    }
    time++;

  });
});
</script>

</body>